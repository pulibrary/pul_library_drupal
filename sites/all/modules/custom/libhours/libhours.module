<?php

/**
 * @file
 * Create a search block
 */

/**
 * Implements hook_block_info().
 */
function libhours_block_info() {
  $blocks['libhours'] = array(
    'info' => t('Library Hours'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function libhours_block_view() {

/**
 * Calling the js file
 */

drupal_add_js(drupal_get_path('module', 'libhours') . '/libhours.js');

/**
 * Calling the css file
 */

drupal_add_css(drupal_get_path('module', 'libhours') . '/libhours.css');

/**
 * Block content
 */

  $mainStart = "<ul class='hours--today'>";
  $mainEnd = "</ul>";
  
  $archRss = new DOMDocument();
  $archRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12309&format=xml&systemTime=1');
  $archHours = $archRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $archHours = "<span class='hours'>".$archHours."</span>";
  $archTitle = "<h3>Architecture Library</h3>";
  $archColor = $archRss->getElementsByTagName('color')->item(0)->nodeValue;
  $arch = "<li><a href='/architecture' class='library-hours-link' style='border-left:".$archColor." 35px solid'>".$archTitle.$archHours."</a></li>";
  
  $ealRss = new DOMDocument();
  $ealRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12310&format=xml&systemTime=1');
  $ealHours = $ealRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $ealHours = "<span class='hours'>".$ealHours."</span>";
  $ealTitle = "<h3>East Asian Library</h3>";
  $ealColor = $ealRss->getElementsByTagName('color')->item(0)->nodeValue;
  $eal = "<li><a href='/eastasian' class='library-hours-link' style='border-left:".$ealColor." 35px solid'>".$ealTitle.$ealHours."</a></li>";

  $engRss = new DOMDocument();
  $engRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=11490&format=xml&systemTime=1');
  $engHours = $engRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $engHours = "<span class='hours'>".$engHours."</span>";
  $engTitle = "<h3>Engineering Library</h3>";
  $engColor = $engRss->getElementsByTagName('color')->item(0)->nodeValue;
  $eng = "<li><a href='/engineering' class='library-hours-link' style='border-left:".$engColor." 35px solid'>".$engTitle.$engHours."</a></li>";

  $fstRss = new DOMDocument();
  $fstRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=6975&format=xml&systemTime=1');
  $fstHours = $fstRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $fstHours = "<span class='hours'>".$fstHours."</span>";
  $fstTitle = "<h3>Firestone Library</h3>";
  $fstColor = $fstRss->getElementsByTagName('color')->item(0)->nodeValue;
  $fst = "<li><a href='/firestone' class='library-hours-link' style='border-left:".$fstColor." 35px solid'>".$fstTitle.$fstHours."</a></li>";

  $lewRss = new DOMDocument();
  $lewRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=7899&format=xml&systemTime=1');
  $lewHours = $lewRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $lewHours = "<span class='hours'>".$lewHours."</span>";
  $lewTitle = "<h3>Lewis Science Library</h3>";
  $lewColor = $lewRss->getElementsByTagName('color')->item(0)->nodeValue;
  $lew = "<li><a href='/lewis' class='library-hours-link' style='border-left:".$lewColor." 35px solid'>".$lewTitle.$lewHours."</a></li>";

  $marqRss = new DOMDocument();
  $marqRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12313&format=xml&systemTime=1');
  $marqHours = $marqRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $marqHours = "<span class='hours'>".$marqHours."</span>";
  $marqTitle = "<h3>Marquand Art Library</h3>";
  $marqColor = $marqRss->getElementsByTagName('color')->item(0)->nodeValue;
  $marq = "<li><a href='/marquand' class='library-hours-link' style='border-left:".$marqColor." 35px solid'>".$marqTitle.$marqHours."</a></li>";

  $mendRss = new DOMDocument();
  $mendRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12314&format=xml&systemTime=1');
  $mendHours = $mendRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $mendHours = "<span class='hours'>".$mendHours."</span>";
  $mendTitle = "<h3>Mendel Music Library</h3>";
  $mendColor = $mendRss->getElementsByTagName('color')->item(0)->nodeValue;
  $mend = "<li><a href='/music' class='library-hours-link' style='border-left:".$mendColor." 35px solid'>".$mendTitle.$mendHours."</a></li>";

  $muddRss = new DOMDocument();
  $muddRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12315&format=xml&systemTime=1');
  $muddHours = $muddRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $muddHours = "<span class='hours'>".$muddHours."</span>";
  $muddTitle = "<h3>Mudd Library</h3>";
  $muddColor = $muddRss->getElementsByTagName('color')->item(0)->nodeValue;
  $mudd = "<li><a href='/special-collections/mudd' class='library-hours-link' style='border-left:".$muddColor." 35px solid'>".$muddTitle.$muddHours."</a></li>";

  $pplRss = new DOMDocument();
  $pplRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=12311&format=xml&systemTime=1');
  $pplHours = $pplRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $pplHours = "<span class='hours'>".$pplHours."</span>";
  $pplTitle = "<h3>Plasma Physics Library</h3>";
  $pplColor = $pplRss->getElementsByTagName('color')->item(0)->nodeValue;
  $ppl = "<li><a href='/plasma-physics' class='library-hours-link' style='border-left:".$pplColor." 35px solid'>".$pplTitle.$pplHours."</a></li>";

  $scRss = new DOMDocument();
  $scRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=14236&format=xml&systemTime=1');
  $scHours = $scRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $scHours = "<span class='hours'>".$scHours."</span>";
  $scTitle = "<h3>Special Collections</h3>";
  $scColor = $scRss->getElementsByTagName('color')->item(0)->nodeValue;
  $sc = "<li><a href='/special-collections' class='library-hours-link' style='border-left:".$scColor." 35px solid'>".$scTitle.$scHours."</a></li>";

  $stokRss = new DOMDocument();
  $stokRss->load('https://libcal.princeton.edu/api_hours_today.php?iid=771&lid=7227&format=xml&systemTime=1');
  $stokHours = $stokRss->getElementsByTagName('rendered')->item(0)->nodeValue;
  $stokHours = "<span class='hours'>".$stokHours."</span>";
  $stokTitle = "<h3>Stokes Library</h3>";
  $stokColor = $stokRss->getElementsByTagName('color')->item(0)->nodeValue;
  $stok = "<li><a href='/stokes' class='library-hours-link' style='border-left:".$stokColor." 35px solid'>".$stokTitle.$stokHours."</a></li>";

  $moreHours = "<a href='https://libcal.princeton.edu/hours' class='views-more-link'>More Hours</a>";
  
  $hoursMain = $mainStart.$arch.$eal.$eng.$fst.$lew.$marq.$mend.$mudd.$ppl.$sc.$stok.$moreHours.$mainEnd;

  $content = $hoursMain;
  $block = array(
    'subject' => t("Today's Hours"),
    'content' => $content,
  );
  return $block;

}